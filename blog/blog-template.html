<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Post - Mathematics PhD Portfolio</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/blog-template.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Open+Sans:wght@400;600&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js"></script>
</head>
<body>
    <!-- Navigation Bar -->
    <nav id="navbar">
        <div class="container">
            <div class="logo">
                <h1><i class="fas fa-infinity"></i></h1>
            </div>
            <div class="menu-toggle">
                <i class="fas fa-bars"></i>
            </div>
            <ul class="nav-menu">
                <li><a href="../index.html" class="nav-link">Home</a></li>
                <li><a href="../research.html" class="nav-link">Research</a></li>
                <li><a href="../blog.html" class="nav-link active">Blog</a></li>
                <li><a href="../teaching.html" class="nav-link">Teaching</a></li>
                <li><a href="../talks.html" class="nav-link">Talks</a></li>
                <li><a href="../contact.html" class="nav-link">Contact</a></li>
            </ul>
        </div>
    </nav>

    <!-- Blog Post Content -->
    <section id="blog-post" class="section">
        <div class="container">
            <div class="blog-breadcrumbs">
                <a href="../index.html">Home</a>
                <span class="separator">/</span>
                <a href="../blog.html">Blog</a>
                <span class="separator">/</span>
                <span id="post-breadcrumb-title">Blog Post</span>
            </div>
            
            <div id="blog-post-content-area">
                <!-- Dynamic content will be loaded here -->
            </div>
            
            <div class="blog-footer">
                 <div class="blog-tags" id="blog-tags-container">
                    <!-- Tags will be loaded here -->
                </div>
                <div class="blog-share">
                    <span>Share:</span>
                    <a href="#" class="share-link"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="share-link"><i class="fab fa-facebook"></i></a>
                    <a href="#" class="share-link"><i class="fab fa-linkedin"></i></a>
                </div>
                <div class="blog-navigation">
                    <!-- Navigation can be added if needed -->
                    <a href="../blog.html" class="all-posts">All Posts</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p>&copy; 2025 Mathematics PhD Portfolio. All rights reserved.</p>
        </div>
    </footer>

    <script src="../js/main.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", async function() {
            const contentArea = document.getElementById("blog-post-content-area");
            const breadcrumbTitle = document.getElementById("post-breadcrumb-title");
            const tagsContainer = document.getElementById("blog-tags-container");

            const urlParams = new URLSearchParams(window.location.search);
            const postFile = urlParams.get("post");

            if (!postFile) {
                contentArea.innerHTML = "<p>Error: No blog post specified.</p>";
                return;
            }

            try {
                // Fetch the Markdown file
                const response = await fetch(postFile); // Assumes postFile is a relative path like 'example-post.md'
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const markdownContent = await response.text();

                // Basic frontmatter parsing (can be made more robust)
                let title = postFile.replace(".md", "").replace(/-/g, " "); // Default title
                let author = "Author";
                let date = "Date";
                let tags = [];
                let mainContent = markdownContent;

                const frontmatterMatch = markdownContent.match(/^---\s*\n([\s\S]*?)\n---\s*\n/);
                if (frontmatterMatch && frontmatterMatch[1]) {
                    const frontmatterText = frontmatterMatch[1];
                    mainContent = markdownContent.substring(frontmatterMatch[0].length);
                    const lines = frontmatterText.split("\n");
                    lines.forEach(line => {
                        const parts = line.split(":");
                        if (parts.length >= 2) {
                            const key = parts[0].trim();
                            const value = parts.slice(1).join(":").trim().replace(/^["']|["']$/g, ""); // Remove quotes
                            if (key === "title") title = value;
                            if (key === "author") author = value;
                            if (key === "date") date = new Date(value).toLocaleDateString("en-US", { year: "numeric", month: "long", day: "numeric" });
                            if (key === "tags") {
                                try {
                                    tags = JSON.parse(value); // Expects tags: ["tag1", "tag2"]
                                } catch (e) {
                                     // Fallback for simple comma-separated tags without brackets
                                    tags = value.split(",").map(tag => tag.trim());
                                }
                            }
                        }
                    });
                }
                
                breadcrumbTitle.textContent = title;
                document.title = `${title} - Mathematics PhD Portfolio`;

                // Construct HTML for header and content
                let htmlContent = `
                    <header class="blog-header">
                        <h1 class="post-title">${title}</h1>
                        <div class="blog-meta">
                            <span class="post-date"><i class="far fa-calendar-alt"></i> ${date}</span>
                            ${tags.length > 0 ? `<span class="post-tags"><i class="fas fa-tags"></i> ${tags.join(", ")}</span>` : ""}
                        </div>
                        <div class="post-author">
                            <img src="../images/profile-placeholder.jpg" alt="Author image" class="author-image">
                            <div class="author-info">
                                <span class="author-name"><i class="fas fa-user"></i> ${author}</span>
                            </div>
                        </div>
                    </header>
                    <article class="blog-content">
                        ${marked.parse(mainContent)}
                    </article>
                `;

                contentArea.innerHTML = htmlContent;

                // Populate tags in the footer
                if (tags.length > 0) {
                    tagsContainer.innerHTML = tags.map(tag => `<span class="tag">${tag}</span>`).join(" ");
                }

                // Render MathJax/KaTeX if present
                if (window.renderMathInElement) {
                    renderMathInElement(contentArea, {
                        delimiters: [
                            {left: "$$", right: "$$", display: true},
                            {left: "$", right: "$", display: false},
                            {left: "\\(", right: "\\)", display: false},
                            {left: "\\[", right: "\\]", display: true}
                        ]
                    });
                }

            } catch (error) {
                console.error("Error fetching or rendering blog post:", error);
                contentArea.innerHTML = `<p>Error loading blog post: ${error.message}. Please check the file path and ensure the Markdown file exists in the 'blog' directory.</p>`;
            }
            
            // Basic menu toggle functionality from main.js (if not already loaded or conflicting)
            const menuToggle = document.querySelector(".menu-toggle");
            const navMenu = document.querySelector(".nav-menu");
            if (menuToggle && navMenu) {
                menuToggle.addEventListener("click", () => {
                    navMenu.classList.toggle("active");
                });
            }
        });
    </script>
</body>
</html>

